apply plugin: 'maven-publish'

afterEvaluate {

    task sourceJar(type: Jar, dependsOn: classes) {
        description = "打包源码"
        //noinspection GroovyAccessibility
        archiveClassifier = "sources"
        from sourceSets.main.allSource
    }

    publishing {
        publications {
            // Creates a Maven publication called "release".
            mavenKotlin(MavenPublication) {
                // Applies the component for the release build variant.
                from components.kotlin
                groupId = "${project.EEG_SERVICE_POM_GROUP_ID}"
                artifactId = "${project.EEG_SERVICE_POM_ARTIFACT_ID}"
                version = "${project.EEG_SERVICE_POM_VERSION}"
                artifact sourceJar // 上传源码
            }
        }

        repositories {
            // 定义一个 maven 仓库
            maven {
                def url = "${project.MAVEN_REPOSITORY_URL}"
                if(url.startsWith("http")){
                    allowInsecureProtocol = true
                    credentials {
                        username = "admin"
                        password = "admin123"
                    }
                }
                setUrl(url)
            }
        }

    }
}